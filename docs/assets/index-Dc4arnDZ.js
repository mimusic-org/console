import{_ as E,a as F}from"./Input-BD4uDKNG.js";import{d as L,u as $,o as j,c as v,a as t,b as o,t as n,w as x,e as _,f as q,r as U,g as V,h as i,i as A,j as D,_ as T,k as I,F as S,l as y,m as h,n as O,p as G}from"./index-DKusDIOD.js";import{l as H}from"./auth-3iQsT5QB.js";import{u as K}from"./request-DV-WdtTg.js";const W={class:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4"},Y={class:"w-full max-w-sm"},J={class:"text-center mb-8"},P={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900/30 mb-4"},Q={class:"text-sm text-muted mt-1"},X={class:"flex items-center justify-between mt-1.5"},Z={key:0,class:"text-sm text-red-500 dark:text-red-400"},ee={key:0,class:"mt-1.5 text-sm text-red-500 dark:text-red-400"},se={key:0,class:"mt-1.5 text-sm text-red-500 dark:text-red-400"},te={class:"text-center text-xs text-gray-400 dark:text-gray-500 mt-6 space-y-1"},re={href:"https://github.com/mimusic-org/mimusic",target:"_blank",rel:"noopener noreferrer",class:"text-primary-500 hover:text-primary-600 hover:underline inline-flex items-center gap-1"},ue=L({__name:"index",setup(ae){const R=A(),M=D(),N=$(),g=K(),d=q(()=>g.isStandalone),c=U(!1),s=V({serverUrl:"",username:"",password:""});j(()=>{d.value&&g.baseURL&&(s.serverUrl=g.baseURL,c.value=!0)});const z=()=>{c.value=!1},r=V({serverUrl:"",username:"",password:""}),m=U(!1),l=U(""),B=()=>{if(r.serverUrl="",r.username="",r.password="",l.value="",d.value){const p=g.validateURL(s.serverUrl);if(!p.valid)return r.serverUrl=p.error||"请输入有效的后台地址",!1}else{if(!s.username)return r.username="请输入用户名",!1;if(!s.password)return r.password="请输入密码",!1;if(s.password.length<4)return r.password="密码长度至少为 4 位",!1}return!0},C=async()=>{var p,e,f;if(B()){m.value=!0,l.value="";try{if(d.value)g.setBaseURL(s.serverUrl),c.value=!0,window.location.href=s.serverUrl;else{const a=await H({username:s.username,password:s.password}),{access_token:k,refresh_token:b,expires_in:w}=a.data;N.setTokens(k,b,w);const u=M.query.redirect;R.push(u||"/")}}catch(a){console.error("操作失败:",a),d.value&&(a.code==="ERR_NETWORK"||a.code==="ECONNREFUSED")?(l.value="无法连接到后台服务器，请检查后台地址是否正确",c.value=!1):((p=a.response)==null?void 0:p.status)===401?l.value="用户名或密码错误":(f=(e=a.response)==null?void 0:e.data)!=null&&f.error?l.value=a.response.data.error:l.value="操作失败，请稍后重试"}finally{m.value=!1}}};return(p,e)=>{const f=T,a=F,k=O,b=G,w=E;return i(),v("div",W,[t("div",Y,[t("div",J,[t("div",P,[o(f,{name:"i-lucide-music",class:"w-8 h-8 text-primary-500"})]),e[3]||(e[3]=t("h1",{class:"text-2xl md:text-3xl font-bold"},"MiMusic",-1)),t("p",Q,n(d.value?"输入后台地址以继续":"登录以继续"),1)]),o(w,{class:"shadow-lg"},{default:x(()=>[t("form",{onSubmit:I(C,["prevent"]),class:"space-y-4"},[d.value?(i(),v(S,{key:0},[t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 后台地址 ",-1)),o(a,{modelValue:s.serverUrl,"onUpdate:modelValue":e[0]||(e[0]=u=>s.serverUrl=u),type:"text",placeholder:"http://localhost:58091",size:"lg",icon:"i-lucide-server",class:"w-full",disabled:c.value&&!!s.serverUrl,required:""},null,8,["modelValue","disabled"]),t("div",X,[r.serverUrl?(i(),v("p",Z,n(r.serverUrl),1)):y("",!0),c.value&&s.serverUrl?(i(),h(k,{key:1,variant:"ghost",size:"xs",onClick:z,class:"ml-auto"},{default:x(()=>[o(f,{name:"i-lucide-pencil",class:"w-3 h-3 mr-1"}),e[4]||(e[4]=_(" 修改地址 ",-1))]),_:1})):y("",!0)])]),l.value?(i(),h(b,{key:0,color:"error",variant:"soft",icon:"i-lucide-alert-circle"},{default:x(()=>[_(n(l.value),1)]),_:1})):y("",!0),o(k,{type:"submit",color:"primary",size:"sm",block:"",loading:m.value,class:"mt-2"},{default:x(()=>[_(n(m.value?"跳转中...":"进入"),1)]),_:1},8,["loading"])],64)):(i(),v(S,{key:1},[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 用户名 ",-1)),o(a,{modelValue:s.username,"onUpdate:modelValue":e[1]||(e[1]=u=>s.username=u),type:"text",placeholder:"请输入用户名",size:"lg",icon:"i-lucide-user",class:"w-full",required:""},null,8,["modelValue"]),r.username?(i(),v("p",ee,n(r.username),1)):y("",!0)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 密码 ",-1)),o(a,{modelValue:s.password,"onUpdate:modelValue":e[2]||(e[2]=u=>s.password=u),type:"password",placeholder:"请输入密码",size:"lg",icon:"i-lucide-lock",class:"w-full",required:""},null,8,["modelValue"]),r.password?(i(),v("p",se,n(r.password),1)):y("",!0)]),l.value?(i(),h(b,{key:0,color:"error",variant:"soft",icon:"i-lucide-alert-circle"},{default:x(()=>[_(n(l.value),1)]),_:1})):y("",!0),o(k,{type:"submit",color:"primary",size:"sm",block:"",loading:m.value,class:"mt-2"},{default:x(()=>[_(n(m.value?"登录中...":"登录"),1)]),_:1},8,["loading"])],64))],32)]),_:1}),t("div",te,[t("p",null,"© "+n(new Date().getFullYear())+" MiMusic",1),t("p",null,[t("a",re,[o(f,{name:"i-lucide-github",class:"w-4 h-4"}),e[8]||(e[8]=_(" GitHub ",-1))])])])])])}}});export{ue as default};
