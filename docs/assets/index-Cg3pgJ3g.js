import{_ as F,a as L}from"./Input-B6mrkBYH.js";import{d as $,u as j,o as q,c as y,a as s,b as n,t as i,w as c,e as u,f as S,r as h,g as V,h as o,i as P,j as A,_ as D,k as H,F as R,l as b,m as I,n as m,p as O}from"./index-Cx4nsS82.js";import{l as G}from"./auth-Y6_zwpfi.js";import{u as K}from"./request-IGgxQWOk.js";const W={class:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4"},Y={class:"w-full max-w-sm"},J={class:"text-center mb-8"},Q={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900/30 mb-4"},X={class:"text-sm text-muted mt-1"},Z={class:"flex items-center justify-between mt-1.5"},ee={key:0,class:"text-sm text-red-500 dark:text-red-400"},se={key:0,class:"mt-1.5 text-sm text-red-500 dark:text-red-400"},te={key:0,class:"mt-1.5 text-sm text-red-500 dark:text-red-400"},re={class:"text-center text-xs text-gray-400 dark:text-gray-500 mt-6 space-y-1"},ae={href:"https://github.com/mimusic-org/mimusic",target:"_blank",rel:"noopener noreferrer",class:"text-primary-500 hover:text-primary-600 hover:underline inline-flex items-center gap-1"},de=$({__name:"index",setup(le){const M=P(),N=A(),T=j(),g=K(),p=S(()=>g.isStandalone),z=S(()=>window.location.protocol.replace(":","")),f=h(!1),t=V({serverUrl:"",username:"",password:""});q(()=>{p.value&&g.baseURL&&(t.serverUrl=g.baseURL,f.value=!0)});const B=()=>{f.value=!1},r=V({serverUrl:"",username:"",password:""}),v=h(!1),l=h(""),C=()=>{if(r.serverUrl="",r.username="",r.password="",l.value="",p.value){const x=g.validateURL(t.serverUrl);if(!x.valid)return r.serverUrl=x.error||"请输入有效的后台地址",!1}else{if(!t.username)return r.username="请输入用户名",!1;if(!t.password)return r.password="请输入密码",!1;if(t.password.length<4)return r.password="密码长度至少为 4 位",!1}return!0},E=async()=>{var x,e,_;if(C()){v.value=!0,l.value="";try{if(p.value)g.setBaseURL(t.serverUrl),f.value=!0,window.location.href=t.serverUrl;else{const a=await G({username:t.username,password:t.password}),{access_token:k,refresh_token:w,expires_in:U}=a.data;T.setTokens(k,w,U);const d=N.query.redirect;M.push(d||"/")}}catch(a){console.error("操作失败:",a),p.value&&(a.code==="ERR_NETWORK"||a.code==="ECONNREFUSED")?(l.value="无法连接到后台服务器，请检查后台地址是否正确",f.value=!1):((x=a.response)==null?void 0:x.status)===401?l.value="用户名或密码错误":(_=(e=a.response)==null?void 0:e.data)!=null&&_.error?l.value=a.response.data.error:l.value="操作失败，请稍后重试"}finally{v.value=!1}}};return(x,e)=>{const _=D,a=L,k=I,w=O,U=F;return o(),y("div",W,[s("div",Y,[s("div",J,[s("div",Q,[n(_,{name:"i-lucide-music",class:"w-8 h-8 text-primary-500"})]),e[3]||(e[3]=s("h1",{class:"text-2xl md:text-3xl font-bold"},"MiMusic",-1)),s("p",X,i(p.value?"输入后台地址以继续":"登录以继续"),1)]),n(U,{class:"shadow-lg"},{default:c(()=>[s("form",{onSubmit:H(E,["prevent"]),class:"space-y-4"},[p.value?(o(),y(R,{key:0},[s("div",null,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 后台地址 ",-1)),n(a,{modelValue:t.serverUrl,"onUpdate:modelValue":e[0]||(e[0]=d=>t.serverUrl=d),type:"text",placeholder:"http://localhost:58091",size:"lg",icon:"i-lucide-server",class:"w-full",disabled:f.value&&!!t.serverUrl,required:""},null,8,["modelValue","disabled"]),z.value==="https"?(o(),b(k,{key:0,color:"warning",variant:"soft",icon:"i-lucide-alert-triangle",class:"mt-2",ui:{description:"text-xs"}},{description:c(()=>[...e[4]||(e[4]=[u(" 当前为 HTTPS 页面，后台地址必须使用 ",-1),s("strong",null,"HTTPS",-1),u(" 协议 ",-1)])]),_:1})):m("",!0),s("div",Z,[r.serverUrl?(o(),y("p",ee,i(r.serverUrl),1)):m("",!0),f.value&&t.serverUrl?(o(),b(w,{key:1,variant:"ghost",size:"xs",onClick:B,class:"ml-auto"},{default:c(()=>[n(_,{name:"i-lucide-pencil",class:"w-3 h-3 mr-1"}),e[5]||(e[5]=u(" 修改地址 ",-1))]),_:1})):m("",!0)])]),l.value?(o(),b(k,{key:0,color:"error",variant:"soft",icon:"i-lucide-alert-circle"},{default:c(()=>[u(i(l.value),1)]),_:1})):m("",!0),n(w,{type:"submit",color:"primary",size:"sm",block:"",loading:v.value,class:"mt-2"},{default:c(()=>[u(i(v.value?"跳转中...":"进入"),1)]),_:1},8,["loading"])],64)):(o(),y(R,{key:1},[s("div",null,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 用户名 ",-1)),n(a,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=d=>t.username=d),type:"text",placeholder:"请输入用户名",size:"lg",icon:"i-lucide-user",class:"w-full",required:""},null,8,["modelValue"]),r.username?(o(),y("p",se,i(r.username),1)):m("",!0)]),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 密码 ",-1)),n(a,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=d=>t.password=d),type:"password",placeholder:"请输入密码",size:"lg",icon:"i-lucide-lock",class:"w-full",required:""},null,8,["modelValue"]),r.password?(o(),y("p",te,i(r.password),1)):m("",!0)]),l.value?(o(),b(k,{key:0,color:"error",variant:"soft",icon:"i-lucide-alert-circle"},{default:c(()=>[u(i(l.value),1)]),_:1})):m("",!0),n(w,{type:"submit",color:"primary",size:"sm",block:"",loading:v.value,class:"mt-2"},{default:c(()=>[u(i(v.value?"登录中...":"登录"),1)]),_:1},8,["loading"])],64))],32)]),_:1}),s("div",re,[s("p",null,"© "+i(new Date().getFullYear())+" MiMusic",1),s("p",null,[s("a",ae,[n(_,{name:"i-lucide-github",class:"w-4 h-4"}),e[9]||(e[9]=u(" GitHub ",-1))])])])])])}}});export{de as default};
