import{a as ve,_ as fe}from"./Input-BD4uDKNG.js";import{a as _e,_ as pe}from"./Tooltip-BaRWGB0Y.js";import{_ as he}from"./Empty-T49dYFNg.js";import{a as se,_ as ye}from"./Checkbox-CD9r7UO_.js";import{_ as ge}from"./Badge-DBVGyaqP.js";import{d as ae,a0 as xe,m as w,w as i,f as B,an as ke,h as t,b as l,e as g,t as f,a as o,n as oe,_ as ne,aB as we,c as r,l as x,F as L,av as ie,s as re,k as W,r as b,aA as be,o as Se,j as $e,aw as Ce,i as ze}from"./index-DKusDIOD.js";import{b as Ue,g as te,r as le,a as Me}from"./playlists-BfR7Hx9x.js";import{u as Pe}from"./player-P-C0EaVL.js";import{l as Ve}from"./songs-DN8gixvE.js";import"./RovingFocusGroup-Csp7M4BH.js";import"./Label-BZeGPxVr.js";import"./useFormControl-DEynCdnu.js";import"./request-DV-WdtTg.js";const je={class:"mb-4"},Be={key:0,class:"flex justify-center py-8"},De={key:1,class:"space-y-1"},Ne={class:"flex items-center gap-3 p-2 border-b border-gray-200 dark:border-gray-700"},Re={key:0,class:"text-sm text-primary ml-auto"},Ae=["onClick"],Ke={class:"w-10 h-10 rounded overflow-hidden bg-gray-100 dark:bg-gray-700 shrink-0"},Ee=["src","alt"],Ie={key:1,class:"w-full h-full flex items-center justify-center"},Te={class:"flex-1 min-w-0"},qe={class:"font-medium truncate text-sm"},Fe={class:"text-xs text-muted truncate"},Le={key:0},Oe={class:"text-xs text-muted"},Ge={key:0,class:"text-center py-8 text-muted"},He={key:1,class:"text-center py-4"},Q=50,Je=ae({__name:"SongPickerModal",props:{open:{type:Boolean},excludeIds:{}},emits:["update:open","confirm"],setup(X,{emit:D}){const P=X,N=D,R=B({get:()=>P.open,set:d=>N("update:open",d)}),C=b(!1),y=b([]),a=b(new Set),c=b(""),p=b(0),m=b(0),U=B(()=>m.value+Q<p.value),k=B(()=>y.value.length===0?!1:y.value.every(d=>a.value.has(d.id))),O=B(()=>{if(y.value.length===0)return!1;const d=y.value.filter(u=>a.value.has(u.id)).length;return d>0&&d<y.value.length});xe(()=>P.open,async d=>{d&&(a.value=new Set,c.value="",m.value=0,y.value=[],await A())});const A=async()=>{C.value=!0;try{const d={limit:Q,offset:m.value};c.value&&(d.keyword=c.value);const S=(await Ve(d)).data,$=S.songs||S.data||[],M=new Set(P.excludeIds||[]),z=$.filter(j=>!M.has(j.id));m.value===0?y.value=z:y.value.push(...z),p.value=S.total||0}catch(d){console.error("加载歌曲列表失败:",d)}finally{C.value=!1}},K=()=>{m.value=0,y.value=[],A()},G=()=>{m.value+=Q,A()},V=d=>{const u=new Set(a.value);u.has(d)?u.delete(d):u.add(d),a.value=u},H=()=>{if(k.value){const d=new Set(a.value);y.value.forEach(u=>d.delete(u.id)),a.value=d}else{const d=new Set(a.value);y.value.forEach(u=>d.add(u.id)),a.value=d}},E=()=>{N("confirm",Array.from(a.value)),I()},I=()=>{N("update:open",!1)},J=d=>{if(!d)return"-";const u=Math.floor(d/60),S=Math.floor(d%60);return`${u}:${S.toString().padStart(2,"0")}`};return(d,u)=>{const S=ne,$=oe,M=ve,z=se,j=ke;return t(),w(j,{open:R.value,"onUpdate:open":u[2]||(u[2]=h=>R.value=h),title:"添加歌曲",description:"选择要添加的歌曲",ui:{body:"max-h-[60vh] overflow-y-auto",footer:"justify-end"}},{body:i(()=>[o("div",je,[l(M,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=h=>c.value=h),placeholder:"搜索歌曲标题、艺术家、专辑...",onKeyup:we(K,["enter"])},{trailing:i(()=>[l($,{variant:"ghost",size:"xs",square:"",onClick:K},{default:i(()=>[l(S,{name:"i-lucide-search",class:"w-4 h-4"})]),_:1})]),_:1},8,["modelValue"])]),C.value?(t(),r("div",Be,[l(S,{name:"i-lucide-loader-2",class:"w-8 h-8 animate-spin text-gray-400"})])):(t(),r("div",De,[o("div",Ne,[l(z,{"model-value":k.value,indeterminate:O.value,"onUpdate:modelValue":H},null,8,["model-value","indeterminate"]),u[3]||(u[3]=o("span",{class:"text-sm text-muted"},"全选",-1)),a.value.size>0?(t(),r("span",Re," 已选 "+f(a.value.size)+" 首 ",1)):x("",!0)]),(t(!0),r(L,null,ie(y.value,h=>(t(),r("div",{key:h.id,class:re(["flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",{"bg-primary/5":a.value.has(h.id)}]),onClick:T=>V(h.id)},[l(z,{"model-value":a.value.has(h.id),"onUpdate:modelValue":T=>V(h.id),onClick:u[1]||(u[1]=W(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),o("div",Ke,[h.cover_url?(t(),r("img",{key:0,src:h.cover_url,alt:h.title,class:"w-full h-full object-cover"},null,8,Ee)):(t(),r("div",Ie,[l(S,{name:"i-lucide-music",class:"w-5 h-5 text-gray-400"})]))]),o("div",Te,[o("h4",qe,f(h.title),1),o("p",Fe,[g(f(h.artist||"未知艺术家")+" ",1),h.album?(t(),r("span",Le," · "+f(h.album),1)):x("",!0)])]),o("span",Oe,f(J(h.duration)),1)],10,Ae))),128)),y.value.length===0?(t(),r("div",Ge,[...u[4]||(u[4]=[o("p",null,"暂无可添加的歌曲",-1)])])):x("",!0),U.value&&!C.value?(t(),r("div",He,[l($,{variant:"ghost",size:"sm",onClick:G},{default:i(()=>[...u[5]||(u[5]=[g(" 加载更多 ",-1)])]),_:1})])):x("",!0)]))]),footer:i(()=>[l($,{variant:"ghost",onClick:I},{default:i(()=>[...u[6]||(u[6]=[g("取消",-1)])]),_:1}),l($,{color:"primary",disabled:a.value.size===0,onClick:E},{default:i(()=>[g(" 添加 "+f(a.value.size>0?`(${a.value.size})`:""),1)]),_:1},8,["disabled"])]),_:1},8,["open"])}}}),Qe={class:"space-y-6"},We={key:0,class:"flex justify-center items-center py-12"},Xe={key:1,class:"space-y-6"},Ye={class:"flex flex-col md:flex-row gap-6"},Ze={class:"w-48 h-48 shrink-0 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 shadow-lg"},et=["src","alt"],tt={key:1,class:"w-full h-full flex items-center justify-center"},lt={class:"flex-1"},st={class:"flex items-center gap-2 mb-2"},at={class:"text-2xl md:text-3xl font-bold mb-2"},ot={key:0,class:"text-sm text-muted mb-4"},nt={class:"flex items-center gap-4 text-sm text-muted"},it={class:"flex gap-2 flex-wrap mt-4"},rt={class:"hidden md:block"},ut={key:2,class:"text-muted"},dt={key:1,class:"text-xs text-muted"},ct={key:2,class:"text-muted"},mt={class:"flex items-center gap-3"},vt={class:"w-10 h-10 rounded overflow-hidden bg-muted shrink-0"},ft=["src","alt"],_t={key:1,class:"w-full h-full flex items-center justify-center"},pt={class:"min-w-0"},ht={class:"font-medium truncate"},yt={class:"text-sm text-muted truncate"},gt={class:"text-muted truncate"},xt={class:"text-muted"},kt={class:"flex justify-end gap-1"},wt={key:0,class:"p-8"},bt={class:"md:hidden divide-y divide-default"},St={key:0,class:"p-8"},$t={key:0,class:"flex items-center gap-3 p-4 bg-muted/50"},Ct={class:"text-sm text-muted"},zt=["onClick"],Ut={key:2,class:"w-6 text-sm text-muted text-center shrink-0"},Mt={class:"w-12 h-12 rounded overflow-hidden bg-muted shrink-0"},Pt=["src","alt"],Vt={key:1,class:"w-full h-full flex items-center justify-center"},jt={class:"flex-1 min-w-0"},Bt={class:"font-medium truncate"},Dt={class:"text-sm text-muted truncate"},Nt={class:"flex items-center gap-2 mt-1"},Rt={class:"text-xs text-muted"},At={class:"text-xs text-muted"},Kt={class:"flex items-center gap-1 shrink-0"},Et={key:2,class:"text-center py-12"},Zt=ae({__name:"PlaylistDetail",setup(X){const D=be(),{confirmDanger:P}=Ce(),N=$e(),R=ze(),C=Pe(),y=b(!0),a=b(null),c=b([]),p=b(!1),m=b(new Set),U=b(!1),k=b(!1),O=[{id:"index",accessorKey:"id",header:"#",class:"w-12"},{id:"title",accessorKey:"title",header:"歌曲"},{id:"album",accessorKey:"album",header:"专辑",class:"hidden lg:table-cell"},{id:"duration",accessorKey:"duration",header:"时长",class:"w-20"},{id:"actions",accessorKey:"id",header:"",class:"w-24"}];Se(()=>{A()});const A=async()=>{const s=Number(N.params.id);if(isNaN(s)){y.value=!1;return}y.value=!0;try{const e=await Ue(s);a.value=e.data;const _=(await te(s,{limit:1e3})).data;c.value=_.songs||_.data||[]}catch(e){console.error("加载歌单详情失败:",e),a.value=null}finally{y.value=!1}},K=()=>{R.push({name:"Playlists"})},G=()=>{c.value.length>0&&(C.clearPlaylist(),c.value.forEach(s=>{C.playSong(s,!0)}),C.playByIndex(0))},V=s=>{C.playSong(s,!0)},H=()=>{var s;R.push({name:"Playlists",query:{edit:(s=a.value)==null?void 0:s.id}})},E=async s=>{if(!(!a.value||!await P("确定要从歌单中移除这首歌曲吗？")))try{await le(a.value.id,s),c.value=c.value.filter(v=>v.id!==s)}catch(v){console.error("移除歌曲失败:",v),D.add({title:"移除歌曲失败",color:"error"})}},I=s=>[[{label:"播放",icon:"i-lucide-play",onSelect:()=>V(s)}],[{label:"从歌单移除",icon:"i-lucide-trash-2",color:"error",onSelect:()=>E(s.id)}]],J=async()=>{if(!(!a.value||m.value.size===0||!await P(`确定要从歌单中移除选中的 ${m.value.size} 首歌曲吗？`)))try{for(const e of m.value)await le(a.value.id,e);c.value=c.value.filter(e=>!m.value.has(e.id)),m.value=new Set,p.value=!1}catch(e){console.error("批量移除歌曲失败:",e),D.add({title:"批量移除歌曲失败",color:"error"})}},d=async s=>{if(!(!a.value||s.length===0))try{for(const _ of s)await Me(a.value.id,{song_id:_});const v=(await te(a.value.id,{limit:1e3})).data;c.value=v.songs||v.data||[]}catch(e){console.error("添加歌曲失败:",e),D.add({title:"添加歌曲失败",color:"error"})}},u=()=>{p.value=!p.value,p.value||(m.value=new Set),p.value&&(k.value=!1)},S=()=>{k.value=!k.value,k.value&&(p.value=!1,m.value=new Set)},$=s=>{const e=new Set(m.value);e.has(s)?e.delete(s):e.add(s),m.value=e},M=B(()=>c.value.length===0?!1:c.value.every(s=>m.value.has(s.id))),z=B(()=>{if(c.value.length===0)return!1;const s=c.value.filter(e=>m.value.has(e.id)).length;return s>0&&s<c.value.length}),j=()=>{if(M.value)m.value=new Set;else{const s=new Set;c.value.forEach(e=>s.add(e.id)),m.value=s}},h=s=>s?new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"-",T=s=>{if(!s||isNaN(s))return"-";const e=Math.floor(s/60),v=Math.floor(s%60);return`${e}:${v.toString().padStart(2,"0")}`};return(s,e)=>{const v=ne,_=oe,Y=ge,q=se,Z=_e,ue=ye,ee=he,de=pe,ce=fe;return t(),r("div",Qe,[l(_,{variant:"ghost",size:"sm",onClick:K},{default:i(()=>[l(v,{name:"i-lucide-arrow-left",class:"w-4 h-4 mr-1"}),e[6]||(e[6]=g(" 返回 ",-1))]),_:1}),y.value?(t(),r("div",We,[l(v,{name:"i-lucide-loader-2",class:"w-8 h-8 animate-spin text-gray-400"})])):a.value?(t(),r("div",Xe,[o("div",Ye,[o("div",Ze,[a.value.cover_url?(t(),r("img",{key:0,src:a.value.cover_url,alt:a.value.name,class:"w-full h-full object-cover"},null,8,et)):(t(),r("div",tt,[l(v,{name:"i-lucide-library",class:"w-20 h-20 text-gray-300 dark:text-gray-600"})]))]),o("div",lt,[o("div",st,[a.value.is_built_in?(t(),w(Y,{key:0,color:"primary",size:"sm"},{default:i(()=>[...e[7]||(e[7]=[g("内置",-1)])]),_:1})):x("",!0),l(Y,{color:a.value.type==="radio"?"warning":"neutral",size:"sm"},{default:i(()=>[g(f(a.value.type==="radio"?"电台":"普通"),1)]),_:1},8,["color"])]),o("h1",at,f(a.value.name),1),a.value.description?(t(),r("p",ot,f(a.value.description),1)):x("",!0),o("div",nt,[o("span",null,f(c.value.length)+" 首歌曲",1),o("span",null,"创建于 "+f(h(a.value.created_at)),1)]),o("div",it,[l(_,{size:"sm",disabled:c.value.length===0,onClick:G},{default:i(()=>[l(v,{name:"i-lucide-play",class:"w-4 h-4 mr-1"}),e[8]||(e[8]=g(" 播放全部 ",-1))]),_:1},8,["disabled"]),l(_,{size:"sm",color:"neutral",variant:"outline",onClick:e[0]||(e[0]=n=>U.value=!0)},{default:i(()=>[l(v,{name:"i-lucide-plus",class:"w-4 h-4 mr-1"}),e[9]||(e[9]=g(" 添加歌曲 ",-1))]),_:1}),!p.value&&c.value.length>0?(t(),w(_,{key:0,size:"sm",color:"neutral",variant:"outline",onClick:u},{default:i(()=>[l(v,{name:"i-lucide-check-square",class:"w-4 h-4 mr-1"}),e[10]||(e[10]=g(" 多选 ",-1))]),_:1})):p.value?(t(),r(L,{key:1},[l(_,{size:"sm",color:"neutral",variant:"ghost",onClick:u},{default:i(()=>[...e[11]||(e[11]=[g(" 取消 ",-1)])]),_:1}),l(_,{size:"sm",color:"error",disabled:m.value.size===0,onClick:J},{default:i(()=>[l(v,{name:"i-lucide-trash-2",class:"w-4 h-4 mr-1"}),g(" 删除 ("+f(m.value.size)+") ",1)]),_:1},8,["disabled"])],64)):x("",!0),c.value.length>1&&!p.value?(t(),w(_,{key:2,size:"sm",color:"neutral",variant:"outline",onClick:S},{default:i(()=>[l(v,{name:"i-lucide-grip-vertical",class:"w-4 h-4 mr-1"}),e[12]||(e[12]=g(" 排序 ",-1))]),_:1})):x("",!0),k.value?(t(),w(_,{key:3,size:"sm",onClick:S},{default:i(()=>[l(v,{name:"i-lucide-check",class:"w-4 h-4 mr-1"}),e[13]||(e[13]=g(" 完成 ",-1))]),_:1})):x("",!0),a.value.is_built_in?x("",!0):(t(),w(_,{key:4,size:"sm",color:"neutral",variant:"outline",onClick:H},{default:i(()=>[l(v,{name:"i-lucide-edit",class:"w-4 h-4 mr-1"}),e[14]||(e[14]=g(" 编辑 ",-1))]),_:1}))])])]),l(ce,{ui:{body:"p-0"}},{default:i(()=>[o("div",rt,[l(ue,{data:c.value,loading:!1,columns:O},{"index-cell":i(({row:n})=>[p.value?(t(),w(q,{key:0,"model-value":m.value.has(n.original.id),"onUpdate:modelValue":F=>$(n.original.id)},null,8,["model-value","onUpdate:modelValue"])):k.value?(t(),w(v,{key:1,name:"i-lucide-grip-vertical",class:"w-4 h-4 text-muted cursor-grab"})):(t(),r("span",ut,f(n.index+1),1))]),"index-header":i(()=>[p.value?(t(),w(q,{key:0,"model-value":M.value,indeterminate:z.value,"onUpdate:modelValue":j},null,8,["model-value","indeterminate"])):k.value?(t(),r("span",dt,"拖拽")):(t(),r("span",ct,"#"))]),"title-cell":i(({row:n})=>[o("div",mt,[o("div",vt,[n.original.cover_url?(t(),r("img",{key:0,src:n.original.cover_url,alt:n.original.title,class:"w-full h-full object-cover"},null,8,ft)):(t(),r("div",_t,[l(v,{name:"i-lucide-music",class:"w-5 h-5 text-muted"})]))]),o("div",pt,[o("p",ht,f(n.original.title),1),o("p",yt,f(n.original.artist||"未知艺术家"),1)])])]),"album-cell":i(({row:n})=>[o("span",gt,f(n.original.album||"-"),1)]),"duration-cell":i(({row:n})=>[o("span",xt,f(T(n.original.duration)),1)]),"actions-cell":i(({row:n})=>[o("div",kt,[l(Z,{text:"播放"},{default:i(()=>[l(_,{icon:"i-lucide-play",size:"sm",color:"neutral",variant:"ghost",onClick:F=>V(n.original)},null,8,["onClick"])]),_:2},1024),!p.value&&!k.value?(t(),w(Z,{key:0,text:"从歌单移除"},{default:i(()=>[l(_,{icon:"i-lucide-x",size:"sm",color:"neutral",variant:"ghost",onClick:F=>E(n.original.id)},null,8,["onClick"])]),_:2},1024)):x("",!0)])]),_:1},8,["data"]),c.value.length===0?(t(),r("div",wt,[l(ee,{icon:"i-lucide-music",title:"暂无歌曲"},{footer:i(()=>[l(_,{size:"sm",color:"primary",onClick:e[1]||(e[1]=n=>U.value=!0)},{default:i(()=>[...e[15]||(e[15]=[g(" 添加歌曲 ",-1)])]),_:1})]),_:1})])):x("",!0)]),o("div",bt,[c.value.length===0?(t(),r("div",St,[l(ee,{icon:"i-lucide-music",title:"暂无歌曲"},{footer:i(()=>[l(_,{size:"sm",color:"primary",onClick:e[2]||(e[2]=n=>U.value=!0)},{default:i(()=>[...e[16]||(e[16]=[g(" 添加歌曲 ",-1)])]),_:1})]),_:1})])):(t(),r(L,{key:1},[p.value?(t(),r("div",$t,[l(q,{"model-value":M.value,indeterminate:z.value,"onUpdate:modelValue":j},null,8,["model-value","indeterminate"]),o("span",Ct,f(m.value.size>0?`已选择 ${m.value.size} 首`:"全选"),1)])):x("",!0),(t(!0),r(L,null,ie(c.value,(n,F)=>(t(),r("div",{key:n.id,class:re(["flex items-center gap-3 p-4 hover:bg-muted/50 transition-colors",{"bg-primary/5":m.value.has(n.id)}]),onClick:me=>p.value?$(n.id):V(n)},[p.value?(t(),w(q,{key:0,"model-value":m.value.has(n.id),"onUpdate:modelValue":me=>$(n.id),onClick:e[3]||(e[3]=W(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"])):k.value?(t(),w(v,{key:1,name:"i-lucide-grip-vertical",class:"w-5 h-5 text-muted cursor-grab shrink-0"})):(t(),r("span",Ut,f(F+1),1)),o("div",Mt,[n.cover_url?(t(),r("img",{key:0,src:n.cover_url,alt:n.title,class:"w-full h-full object-cover"},null,8,Pt)):(t(),r("div",Vt,[l(v,{name:"i-lucide-music",class:"w-6 h-6 text-muted"})]))]),o("div",jt,[o("h3",Bt,f(n.title),1),o("p",Dt,f(n.artist||"未知艺术家"),1),o("div",Nt,[o("span",Rt,f(n.album||"-"),1),e[17]||(e[17]=o("span",{class:"text-xs text-muted"},"·",-1)),o("span",At,f(T(n.duration)),1)])]),o("div",Kt,[!p.value&&!k.value?(t(),w(de,{key:0,items:I(n)},{default:i(()=>[l(_,{icon:"i-lucide-more-vertical",size:"sm",color:"neutral",variant:"ghost",onClick:e[4]||(e[4]=W(()=>{},["stop"]))})]),_:1},8,["items"])):x("",!0)])],10,zt))),128))],64))])]),_:1})])):(t(),r("div",Et,[l(v,{name:"i-lucide-alert-circle",class:"w-16 h-16 mx-auto text-muted mb-4"}),e[19]||(e[19]=o("p",{class:"text-muted"},"歌单不存在或加载失败",-1)),l(_,{size:"sm",variant:"outline",class:"mt-4",onClick:K},{default:i(()=>[...e[18]||(e[18]=[g("返回歌单列表",-1)])]),_:1})])),l(Je,{open:U.value,"onUpdate:open":e[5]||(e[5]=n=>U.value=n),"exclude-ids":c.value.map(n=>n.id),onConfirm:d},null,8,["open","exclude-ids"])])}}});export{Zt as default};
