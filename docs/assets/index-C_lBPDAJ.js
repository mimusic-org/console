import{_ as z,a as L}from"./Input-DDTBGATf.js";import{d as $,u as j,o as q,c as _,a as s,b as o,w as g,t as p,e as f,f as S,r as U,g as V,h as n,i as P,j as A,_ as D,k as F,l as h,m as H,n as u,p as I}from"./index-oVUmxvzP.js";import{l as O}from"./auth-nzKDW51_.js";import{u as G}from"./request-C_Cw0Cd4.js";const K={class:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4"},W={class:"w-full max-w-sm"},Y={class:"text-center mb-8"},J={class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900/30 mb-4"},Q={key:0},X={class:"flex items-center justify-between mt-1.5"},Z={key:0,class:"text-sm text-red-500 dark:text-red-400"},ee={key:0,class:"mt-1.5 text-sm text-red-500 dark:text-red-400"},se={key:0,class:"mt-1.5 text-sm text-red-500 dark:text-red-400"},te={class:"text-center text-xs text-gray-400 dark:text-gray-500 mt-6 space-y-1"},re={href:"https://github.com/mimusic-org/mimusic",target:"_blank",rel:"noopener noreferrer",class:"text-primary-500 hover:text-primary-600 hover:underline inline-flex items-center gap-1"},ue=$({__name:"index",setup(ae){const R=P(),M=A(),N=j(),v=G(),x=S(()=>v.isStandalone),T=S(()=>window.location.protocol.replace(":","")),d=U(!1),t=V({serverUrl:"",username:"",password:""});q(()=>{x.value&&v.baseURL&&(t.serverUrl=v.baseURL,d.value=!0)});const B=()=>{d.value=!1},r=V({serverUrl:"",username:"",password:""}),y=U(!1),l=U(""),C=()=>{if(r.serverUrl="",r.username="",r.password="",l.value="",x.value){const c=v.validateURL(t.serverUrl);if(!c.valid)return r.serverUrl=c.error||"请输入有效的后台地址",!1}return t.username?t.password?t.password.length<4?(r.password="密码长度至少为 4 位",!1):!0:(r.password="请输入密码",!1):(r.username="请输入用户名",!1)},E=async()=>{var c,e,m;if(C()){y.value=!0,l.value="";try{x.value&&(v.setBaseURL(t.serverUrl),d.value=!0);const a=await O({username:t.username,password:t.password}),{access_token:w,refresh_token:k,expires_in:b}=a.data;N.setTokens(w,k,b);const i=M.query.redirect;R.push(i||"/")}catch(a){console.error("登录失败:",a),x.value&&(a.code==="ERR_NETWORK"||a.code==="ECONNREFUSED")?(l.value="无法连接到后台服务器，请检查后台地址是否正确",d.value=!1):((c=a.response)==null?void 0:c.status)===401?l.value="用户名或密码错误":(m=(e=a.response)==null?void 0:e.data)!=null&&m.error?l.value=a.response.data.error:l.value="登录失败，请稍后重试"}finally{y.value=!1}}};return(c,e)=>{const m=D,a=L,w=H,k=I,b=z;return n(),_("div",K,[s("div",W,[s("div",Y,[s("div",J,[o(m,{name:"i-lucide-music",class:"w-8 h-8 text-primary-500"})]),e[3]||(e[3]=s("h1",{class:"text-2xl md:text-3xl font-bold"},"MiMusic",-1)),e[4]||(e[4]=s("p",{class:"text-sm text-muted mt-1"},"登录以继续",-1))]),o(b,{class:"shadow-lg"},{default:g(()=>[s("form",{onSubmit:F(E,["prevent"]),class:"space-y-4"},[x.value?(n(),_("div",Q,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 后台地址 ",-1)),o(a,{modelValue:t.serverUrl,"onUpdate:modelValue":e[0]||(e[0]=i=>t.serverUrl=i),type:"text",placeholder:"http://localhost:58091",size:"lg",icon:"i-lucide-server",class:"w-full",disabled:d.value&&!!t.serverUrl,required:""},null,8,["modelValue","disabled"]),T.value==="https"?(n(),h(w,{key:0,color:"warning",variant:"soft",icon:"i-lucide-alert-triangle",class:"mt-2",ui:{description:"text-xs"}},{description:g(()=>[...e[5]||(e[5]=[f(" 当前为 HTTPS 页面，后台地址必须使用 ",-1),s("strong",null,"HTTPS",-1),f(" 协议 ",-1)])]),_:1})):u("",!0),s("div",X,[r.serverUrl?(n(),_("p",Z,p(r.serverUrl),1)):u("",!0),d.value&&t.serverUrl?(n(),h(k,{key:1,variant:"ghost",size:"xs",onClick:B,class:"ml-auto"},{default:g(()=>[o(m,{name:"i-lucide-pencil",class:"w-3 h-3 mr-1"}),e[6]||(e[6]=f(" 修改地址 ",-1))]),_:1})):u("",!0)])])):u("",!0),s("div",null,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 用户名 ",-1)),o(a,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=i=>t.username=i),type:"text",placeholder:"请输入用户名",size:"lg",icon:"i-lucide-user",class:"w-full",required:""},null,8,["modelValue"]),r.username?(n(),_("p",ee,p(r.username),1)):u("",!0)]),s("div",null,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5"}," 密码 ",-1)),o(a,{modelValue:t.password,"onUpdate:modelValue":e[2]||(e[2]=i=>t.password=i),type:"password",placeholder:"请输入密码",size:"lg",icon:"i-lucide-lock",class:"w-full",required:""},null,8,["modelValue"]),r.password?(n(),_("p",se,p(r.password),1)):u("",!0)]),l.value?(n(),h(w,{key:1,color:"error",variant:"soft",icon:"i-lucide-alert-circle"},{default:g(()=>[f(p(l.value),1)]),_:1})):u("",!0),o(k,{type:"submit",color:"primary",size:"sm",block:"",loading:y.value,class:"mt-2"},{default:g(()=>[f(p(y.value?"登录中...":"登录"),1)]),_:1},8,["loading"])],32)]),_:1}),s("div",te,[s("p",null,"© "+p(new Date().getFullYear())+" MiMusic",1),s("p",null,[s("a",re,[o(m,{name:"i-lucide-github",class:"w-4 h-4"}),e[10]||(e[10]=f(" GitHub ",-1))])])])])])}}});export{ue as default};
