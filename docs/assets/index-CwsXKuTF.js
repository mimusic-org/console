import{d as E,aA as O,o as A,a0 as I,c,a as o,b as a,w as n,F as G,av as H,r,p as J,an as K,h as d,_ as Q,e as m,t as x,l as W,n as X,k as Y,i as Z,j as ee}from"./index-Cx4nsS82.js";import{_ as le}from"./Textarea-MHVU4wbX.js";import{_ as te,a as oe}from"./Input-B6mrkBYH.js";import{_ as ae}from"./Badge-BKBTRCCv.js";import{_ as se}from"./Select-BhDG758d.js";import{l as ne,d as ie,u as re,c as ue}from"./playlists-BVI2tCg5.js";import"./useFormControl-CYTDve-I.js";import"./request-IGgxQWOk.js";const de={class:"space-y-6"},ce={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},me={class:"flex flex-col sm:flex-row gap-4 space-y-0"},pe={class:"flex-1"},ve={key:0,class:"flex justify-center items-center py-12"},fe={key:1,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"},ye=["onClick"],_e={class:"relative aspect-square rounded-lg overflow-hidden bg-muted mb-2"},be=["src","alt"],ge={key:1,class:"w-full h-full flex items-center justify-center bg-linear-to-br from-primary/20 to-primary/5"},xe={class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},we={class:"font-medium truncate text-sm"},ke={class:"text-xs text-muted truncate"},Ve={key:2,class:"text-center py-12"},Ue={class:"mb-4"},he={class:"mb-4"},Ce={class:"mb-4"},$e={class:"mb-4"},Te=E({__name:"index",setup(je){const k=O(),h=Z(),N=ee(),V=r(!1),y=r([]),_=r({type:"all"}),b=r(!1),U=r(!1),p=r(!1),v=r(!1),s=r({name:"",description:"",type:"normal",cover_url:""}),f=r(null),w=r(null),P=[{value:"all",label:"全部类型"},{value:"normal",label:"普通歌单"},{value:"radio",label:"电台歌单"}],z=[{value:"normal",label:"普通歌单"},{value:"radio",label:"电台歌单"}],C=()=>{f.value=null,s.value={name:"",description:"",type:"normal",cover_url:""},b.value=!0},g=async()=>{V.value=!0;try{const t={};_.value.type&&_.value.type!=="all"&&(t.type=_.value.type);const i=(await ne(t)).data;y.value=i.playlists||i.data||[]}catch(t){console.error("加载歌单列表失败:",t),k.add({title:"加载歌单列表失败",color:"error"})}finally{V.value=!1}},B=t=>{h.push("/playlists/"+t)},D=t=>{f.value=t,s.value={name:t.name,description:t.description||"",type:t.type,cover_url:t.cover_url||""},b.value=!0},q=async()=>{if(w.value){v.value=!0;try{await ie(w.value.id),U.value=!1,w.value=null,g()}catch(t){console.error("删除歌单失败:",t),k.add({title:"删除歌单失败",color:"error"})}finally{v.value=!1}}},R=async()=>{p.value=!0;try{if(f.value){const t={name:s.value.name,description:s.value.description,cover_url:s.value.cover_url};await re(f.value.id,t)}else await ue(s.value);S(),g()}catch(t){console.error("操作失败:",t),k.add({title:"操作失败",color:"error"})}finally{p.value=!1}},S=()=>{b.value=!1,f.value=null,s.value={name:"",description:"",type:"normal",cover_url:""}};return A(()=>{g()}),I(()=>N.query.edit,async t=>{if(t){const e=Number(t);if(!isNaN(e)){y.value.length===0&&await g();const i=y.value.find(u=>u.id===e);i&&(D(i),h.replace({query:{}}))}}},{immediate:!0}),(t,e)=>{const i=Q,u=J,$=se,T=te,F=ae,j=oe,L=le,M=K;return d(),c("div",de,[o("div",ce,[e[8]||(e[8]=o("div",null,[o("h1",{class:"text-2xl md:text-3xl font-bold"},"歌单管理"),o("p",{class:"text-sm text-muted mt-1"},"管理您的音乐歌单")],-1)),a(u,{size:"sm",color:"primary",onClick:C},{default:n(()=>[a(i,{name:"i-lucide-plus",class:"w-4 h-4"}),e[7]||(e[7]=m(" 创建歌单 ",-1))]),_:1})]),a(T,null,{default:n(()=>[o("div",me,[o("div",pe,[a($,{modelValue:_.value.type,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value.type=l),items:P,"value-key":"value",onChange:g},null,8,["modelValue"])])])]),_:1}),V.value?(d(),c("div",ve,[a(i,{name:"i-lucide-loader-2",class:"w-8 h-8 animate-spin text-gray-400"})])):y.value.length>0?(d(),c("div",fe,[(d(!0),c(G,null,H(y.value,l=>(d(),c("div",{key:l.id,class:"group cursor-pointer",onClick:Me=>B(l.id)},[o("div",_e,[l.cover_url?(d(),c("img",{key:0,src:l.cover_url,alt:l.name,class:"w-full h-full object-cover transition-transform group-hover:scale-105"},null,8,be)):(d(),c("div",ge,[a(i,{name:"i-lucide-list-music",class:"w-12 h-12 text-primary/50"})])),o("div",xe,[a(u,{icon:"i-lucide-eye",color:"primary",size:"lg",class:"rounded-full"})])]),o("h3",we,[m(x(l.name)+" ",1),l.is_built_in?(d(),W(F,{key:0,color:"primary",size:"sm",class:"ml-1"},{default:n(()=>[...e[9]||(e[9]=[m("内置",-1)])]),_:1})):X("",!0)]),o("p",ke,x(l.description||"暂无描述"),1)],8,ye))),128))])):(d(),c("div",Ve,[a(i,{name:"i-lucide-library",class:"w-24 h-24 mx-auto text-gray-300 mb-4"}),e[11]||(e[11]=o("p",{class:"text-gray-500"},"暂无歌单",-1)),a(u,{color:"primary",size:"sm",onClick:C},{default:n(()=>[...e[10]||(e[10]=[m(" 创建第一个歌单 ",-1)])]),_:1})])),a(M,{open:b.value,"onUpdate:open":e[5]||(e[5]=l=>b.value=l),title:f.value?"编辑歌单":"创建歌单",description:"管理歌单信息",ui:{width:"max-w-xl",footer:"justify-end"}},{body:n(()=>[o("form",{id:"playlist-form",onSubmit:Y(R,["prevent"])},[o("div",Ue,[e[12]||(e[12]=o("label",{class:"block text-sm font-medium mb-1"},"名称 *",-1)),a(j,{modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.name=l),placeholder:"请输入歌单名称",class:"w-full",required:""},null,8,["modelValue"])]),o("div",he,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium mb-1"},"描述",-1)),a(L,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.description=l),placeholder:"请输入歌单描述",class:"w-full",rows:3},null,8,["modelValue"])]),o("div",Ce,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium mb-1"},"类型",-1)),a($,{modelValue:s.value.type,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.type=l),items:z,"value-key":"value",class:"w-full"},null,8,["modelValue"])]),o("div",$e,[e[15]||(e[15]=o("label",{class:"block text-sm font-medium mb-1"},"封面 URL",-1)),a(j,{modelValue:s.value.cover_url,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.cover_url=l),type:"url",placeholder:"请输入封面图片 URL",class:"w-full"},null,8,["modelValue"])])],32)]),footer:n(({close:l})=>[a(u,{variant:"ghost",disabled:p.value,onClick:l},{default:n(()=>[...e[16]||(e[16]=[m(" 取消 ",-1)])]),_:1},8,["disabled","onClick"]),a(u,{type:"submit",form:"playlist-form",color:"primary",size:"sm",disabled:p.value,loading:p.value},{default:n(()=>[m(x(p.value?"提交中...":"确定"),1)]),_:1},8,["disabled","loading"])]),_:1},8,["open","title"]),a(M,{open:U.value,"onUpdate:open":e[6]||(e[6]=l=>U.value=l),title:"确认删除",description:"删除歌单操作不可恢复",ui:{footer:"justify-end"}},{body:n(()=>{var l;return[o("p",null,"确定要删除歌单「"+x((l=w.value)==null?void 0:l.name)+"」吗？此操作不可恢复。",1)]}),footer:n(({close:l})=>[a(u,{variant:"ghost",disabled:v.value,onClick:l},{default:n(()=>[...e[17]||(e[17]=[m(" 取消 ",-1)])]),_:1},8,["disabled","onClick"]),a(u,{color:"red",size:"sm",disabled:v.value,loading:v.value,onClick:q},{default:n(()=>[m(x(v.value?"删除中...":"确定删除"),1)]),_:1},8,["disabled","loading"])]),_:1},8,["open"])])}}});export{Te as default};
